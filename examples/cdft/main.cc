#include <lbm.hh>

// This script simulates a Poiseuille flow in a channel driven by an external force

const int lx = 1001;  // Size of domain in x direction
const int ly = 1;   // Size of domain in y direction

const int timesteps = 5000;    // Number of iterations to perform
const int saveInterval = 10;  // Interval to save global data

// Function used to define the solid geometry
// Here we set a solid at the top and bottom
int initSolid(const int k) {
    return 0;
}

double calcElectricField(int k) {

    double L=k/((double)lx)*20;
    
    double elec = cos(2*M_PI*4/20*L)/(2*M_PI*4)*20*0.5 / (1.380649e-23 * 500 / 1.60217553e-19);
    
    return elec;
}

double initDensity(int k) {
    std::vector<double> vc = {0.005064288780313499, 0.005065418349583467, 0.005075978957873919, 0.0050975309370218675, 0.005129998443278864, 0.005173522057891662, 0.005228069974282495, 0.005293079136518642, 0.005367999874539214, 0.005452418727320995, 0.005546021401941594, 0.005648614158657965, 0.005760076313924403, 0.005880355965844542, 0.006009430193907406, 0.006147284789655061, 0.00629392599460638, 0.006449377731283092, 0.0066136938183070934, 0.006786892221651756, 0.006968989138006339, 0.00715994119304249, 0.007359772699691837, 0.007568429715424959, 0.007785917361469846, 0.008012122526924953, 0.008246948932747949, 0.008490250413286179, 0.008741866256842094, 0.009001574718703814, 0.00926895495256643, 0.00954375158106415, 0.009825419144610449, 0.010113362388080364, 0.010406905356033414, 0.010705269754556665, 0.011007565053887176, 0.01131275878582524, 0.011619885430506445, 0.011927778851351345, 0.012235328203195953, 0.012541241627169094, 0.012844229105470919, 0.013143108812201655, 0.013436545985273786, 0.013723207986947912, 0.014001792981005045, 0.014271045787805789, 0.014529643622204696, 0.014776369757103692, 0.015010083432854027, 0.015229662687408083, 0.015433943954821743, 0.015622086035355214, 0.015792968710272366, 0.01594594107246007, 0.016080121837032554, 0.016194946000784274, 0.016289835718450767, 0.01636442942105193, 0.016418581861694398, 0.016452446824378512, 0.016466639471248587, 0.016461463585360374, 0.016436597963931817, 0.016391448143822394, 0.01632570264835979, 0.016239263202480286, 0.01613257655718218, 0.016006091256837347, 0.01586039700773162, 0.015696139206503545, 0.015514260211004518, 0.01531556448260696, 0.015101099708435648, 0.014871976960600412, 0.014629307090293548, 0.014374241046747808, 0.014108071111856845, 0.0138320922566529, 0.013547624837330187, 0.01325587739274559, 0.012958276603529948, 0.012656078125398974, 0.012350615076843591, 0.012043104595615178, 0.011734832678626298, 0.011426981100788554, 0.011120679806101298, 0.010817004034973573, 0.010516929945183617, 0.010221400188233839, 0.009931200335403328, 0.009647119507410477, 0.009369686176141834, 0.00909952384009153, 0.008836983065248967, 0.00858243044660044, 0.008336104218593153, 0.008098229634618656, 0.007868930931110754, 0.007648313791566443, 0.007436467791648335, 0.007233461080250576, 0.00703931526010801, 0.006854002044327887, 0.006677592005523058, 0.006510000800076151, 0.0063512716278602485, 0.0062013186622040285, 0.006060119528046964, 0.005927708804391409, 0.005804011998697094, 0.005689079818825407, 0.0055829032805436996, 0.005485581172412603, 0.005397272815390744, 0.005318163674553863, 0.005248589482227993, 0.005189022429082831, 0.005140041764193472, 0.00510233868226821, 0.005076269117754849, 0.00506176986082019, 0.005058032645814765, 0.005060125532137333, 0.005065279970977318, 0.0050783318634648935, 0.005100781584867961, 0.005132732820411552, 0.0051744842681673425, 0.005226242902945553, 0.00528796006751654, 0.005359511013520693, 0.005440675349170556, 0.0055312683505719515, 0.00563112832487758, 0.005740107664904496, 0.005858119643108656, 0.005985122791242501, 0.006121063896654649, 0.006265932474570439, 0.006419731644495697, 0.0065825026250604475, 0.006754192355060417, 0.006934862174271458, 0.007124430826408333, 0.007322956584585176, 0.0075303503804556885, 0.007746584440220287, 0.007971548789223697, 0.00820517222632523, 0.008447280804667005, 0.008697701552117685, 0.008956190456273813, 0.009222463751070633, 0.009496148645382925, 0.009776769364424325, 0.010063760771864862, 0.010356509453372771, 0.010654202583712202, 0.010956060899951657, 0.01126103702034776, 0.01156815566166262, 0.011876270716829245, 0.012184253744633132, 0.012490859329191318, 0.012794758783652733, 0.013094743086540605, 0.013389365382137416, 0.013677286112416582, 0.013957253432125801, 0.014227813120187248, 0.01448765589857458, 0.014735497670738841, 0.014970243454692285, 0.015190516160914871, 0.015395178577687994, 0.015583335851040235, 0.01575402655674332, 0.01590664852661257, 0.01604097695417381, 0.016156919070611894, 0.016253972770524934, 0.0163313687539428, 0.01638857304448095, 0.016425132260542402, 0.016440815918585865, 0.016435472352936974, 0.016409068320015718, 0.016361852452335734, 0.016294122372636763, 0.01620675000511534, 0.016100808345222522, 0.015978016568396203, 0.01583934167441095, 0.015684494945695494, 0.01551270034523668, 0.015323734581668483, 0.01511822599536932, 0.01489692912617319, 0.014661179676891914, 0.014412160417813985, 0.014151113611168725, 0.013879470927095268, 0.013598562261576545, 0.0133097688815896, 0.013014500292339646, 0.012714163737249767, 0.01241009232059748, 0.012103499180710698, 0.011795754407231913, 0.011488131325163067, 0.011181688447601406, 0.010877547656057286, 0.010576752450358287, 0.010280242668233073, 0.009988840283382391, 0.009703289447052224, 0.009424241513100597, 0.00915220010962654, 0.00888766887274904, 0.00863101115811847, 0.00838249734062212, 0.008142361370931609, 0.007910787464757698, 0.007687880813253773, 0.007473743668722938, 0.0072684804450403, 0.007072091560103333, 0.00688465509416808, 0.006706160608534755, 0.0065365934451231, 0.006376004810257514, 0.006224326645916229, 0.006081582801399651, 0.005947791169271698, 0.005822914499716693, 0.005707086073699571, 0.005600288046235116, 0.005502648768355173, 0.005414347102597276, 0.005335552675503473, 0.005266502879759411, 0.005207425077957078, 0.00515858269169772, 0.0051201058734722206, 0.005092060876655215, 0.005074286874434947, 0.005066433946099478, 0.005064403138553018, 0.005063458299668813, 0.005069054202780382, 0.0050854033470235215, 0.0051126307225884265, 0.005150799232932146, 0.005200051014998208, 0.005260036357224239, 0.005330199091841505, 0.0054100506401239925, 0.005499209362287882, 0.005597498444816801, 0.005704736537164639, 0.005820781151515171, 0.005945683395679981, 0.006079384969924943, 0.006221921850255679, 0.006373288281022568, 0.0065335325925704405, 0.006702654826998435, 0.006880698691244882, 0.007067719327466339, 0.007263607434671003, 0.007468437489370236, 0.007682128821289113, 0.007904657296546646, 0.00813592223981878, 0.008375769010539524, 0.00862407445152773, 0.008880652756586824, 0.009145156683865814, 0.0094172882214232, 0.009696577229774581, 0.009982486189019039, 0.01027436516108343, 0.010571507282352986, 0.010872953429253499, 0.01117784175026702, 0.011485140700921903, 0.011793719684860949, 0.012102440658649176, 0.012410020597975196, 0.012715329220620733, 0.013016946570276959, 0.013313652803061586, 0.013604064840655693, 0.013886866700142326, 0.01416084931167683, 0.014424496449952764, 0.01467668032570673, 0.01491620430013187, 0.015141849824578748, 0.015352502102305191, 0.015547178608001429, 0.015724814642609705, 0.015884739114204478, 0.016025985495956768, 0.016147903651099423, 0.016249905773898853, 0.016331631673471573, 0.016392737005715797, 0.016433364830856344, 0.0164539486006377, 0.016454910160545722, 0.016436188702133037, 0.01639725187796183, 0.016337677365108924, 0.016257233212719976, 0.016156260745909798, 0.016035202953924358, 0.01589455385681718, 0.01573506181606719, 0.015557545429563589, 0.01536283472888566, 0.015151988648329187, 0.014926011831382072, 0.014686083486026548, 0.01443341868674081, 0.014169145102916137, 0.013894715352417441, 0.013611314005790137, 0.013320335297274988, 0.013023101289523407, 0.012720949917636785, 0.012415135912357265, 0.012107017587129251, 0.011797875745522412, 0.011488816053306573, 0.011181126276121606, 0.010875817320608163, 0.010573941111010801, 0.010276440821739929, 0.009984169902087999, 0.009697908223343217, 0.009418266668510507, 0.009145801520690538, 0.008880968115431752, 0.008624161553382238, 0.008375566703761345, 0.008135470940006521, 0.007904007379764866, 0.007681241081414026, 0.00746735606813044, 0.007262332993064721, 0.007066216653916896, 0.006879041326008048, 0.006700780642065463, 0.0065314115803253, 0.0063709606586549545, 0.006219345468840377, 0.006076553061433341, 0.0059425734245718105, 0.0058173766981522, 0.005700977985886343, 0.005593377939351804, 0.005494674327617134, 0.005404983490727639, 0.00532453455023763, 0.005253598034805361, 0.0051926541738845896, 0.005142271173166612, 0.005103183541247327, 0.00507585971274503, 0.005060355118338813, 0.005055846751372594, 0.005057349772902559, 0.005060486654373713, 0.005070088960193897, 0.005089186161606979, 0.005118045739938465, 0.005156978568295058, 0.005206081155073104, 0.005265309218418658, 0.00533448552583434, 0.00541339555118849, 0.005501812771418011, 0.005599550264575828, 0.0057064468129935176, 0.005822446510582237, 0.0059474359088930555, 0.006081366491883203, 0.006224308046353639, 0.006376145063860049, 0.006536947429668609, 0.006706705842009488, 0.0068854224183995194, 0.007073110342207705, 0.007269727679249056, 0.00747522574776215, 0.007689573249528109, 0.007912728239501187, 0.008144523508195925, 0.008384896573498703, 0.008633619023311447, 0.008890470896403078, 0.009155166847489193, 0.009427370373386944, 0.009706581876814096, 0.00999235002520275, 0.010284000985011699, 0.0105807633920798, 0.010881818752544715, 0.011186163188801756, 0.011492938743855477, 0.011800862252329628, 0.012108870604365728, 0.01241569933480587, 0.012720052323151624, 0.013020725674396052, 0.013316208109987465, 0.013605265559667337, 0.013886521120134058, 0.014158586324914835, 0.01442015013417167, 0.014669903122131846, 0.014906628421192777, 0.015129049824730435, 0.015335993029722278, 0.01552660915186192, 0.015699798068619132, 0.01585495749388005, 0.015991874815104574, 0.01611037421784446, 0.016209969217165224, 0.016290058013493872, 0.016349982341978667, 0.016389199439045016, 0.01640759174306428, 0.016404943645291083, 0.016381212817210864, 0.01633647662744925, 0.01627122587537074, 0.016186107030576245, 0.016082170712929028, 0.01596121435973987, 0.015824292874678327, 0.015671356017878488, 0.015501584066072958, 0.015314602564842652, 0.015110901651209563, 0.01489136749853096, 0.014657172039604786, 0.014409505042835481, 0.014149675795120274, 0.013879032438113807, 0.013599038768640947, 0.013310998032974367, 0.01301631368663389, 0.012716469048774671, 0.012412654792923264, 0.012106326365556834, 0.011798733336337571, 0.01149109843516938, 0.011184618016581487, 0.010880348101343891, 0.010579361102496626, 0.010282585471555736, 0.009990926096617881, 0.009705031767541982, 0.009425653547491938, 0.009153266798656228, 0.008888375888480167, 0.008631334835232821, 0.008382455054182064, 0.008141954214938582, 0.007910017111851915, 0.0076867066341592405, 0.0074722739558113595, 0.0072666654252717304, 0.007069966767892774, 0.006882225037582808, 0.00670341595302058, 0.006533598583041221, 0.006372732525151669, 0.006220802819685356, 0.006077830203776585, 0.0059437975800010106, 0.0058187607461507775, 0.005702714154608305, 0.005595760185393848, 0.005497961665039594, 0.005409520399413192, 0.0053305994052740505, 0.005261407651594184, 0.0052022319969038545, 0.005153293137356531, 0.005114756277334846, 0.005086628397350612, 0.005068802974982255, 0.005060889252406334, 0.005058811731985741, 0.005057815466273755, 0.005063360674068596, 0.0050796414333714466, 0.005106814076395518, 0.005144937390416552, 0.005194125189637456, 0.0052540680779394515, 0.00532419039308973, 0.005404004656680908, 0.005493141706731585, 0.0055913767695550875, 0.005698527526260612, 0.005814563009041399, 0.005939415476700709, 0.006073090836973422, 0.006215550018019721, 0.006366881909436342, 0.0065270970179642975, 0.006696210616596462, 0.006874238586187188, 0.007061172305436559, 0.007257077424255164, 0.00746188267890845, 0.007675564557465666, 0.007898100793515838, 0.008129324695705273, 0.008369195238200972, 0.0086175289172808, 0.008874105679600428, 0.009138655252895835, 0.009410825068082074, 0.009690111813138395, 0.009976046045569252, 0.010268012400119469, 0.01056519208574475, 0.010866731093459595, 0.011171655815576996, 0.011479065886298432, 0.011787735999970964, 0.01209657145683095, 0.01240426406741648, 0.012709699457184026, 0.013011430653977491, 0.013308243384533298, 0.01359881357006314, 0.013881760655348515, 0.014155751519581351, 0.014419609008565145, 0.01467192519162686, 0.014911551224117156, 0.015137328950493835, 0.015348118252444254, 0.01554290197946256, 0.015720692319370566, 0.015880655255067235, 0.016021999872249528, 0.016143946944578647, 0.0162460671834143, 0.016327889430634245, 0.01638893904191276, 0.01642961146991814, 0.01645017560414842, 0.016451167396290125, 0.016432482131842698, 0.016393543247366527, 0.016333866104730393, 0.016253436408711852, 0.016152419634441348, 0.0160313045983208, 0.015890625125654628, 0.015731102924553285, 0.015553456235500767, 0.015358707385421262, 0.015147803475493521, 0.01492175616725095, 0.014681734131180322, 0.0144290026520517, 0.014164693657986225, 0.013890210431981834, 0.01360676015797399, 0.013315704398515307, 0.013018406498012908, 0.012716238165223747, 0.012410385470839353, 0.012102224035926678, 0.011793050559955916, 0.011484018664705971, 0.011176266544626147, 0.010870941272391584, 0.010569075411377783, 0.010271587306028581, 0.009979361249418235, 0.009693111821105391, 0.009413485852716617, 0.009141061343163632, 0.008876294587185798, 0.00861949801636755, 0.008370930264359358, 0.008130898868016056, 0.00789948293048936, 0.0076768045313317735, 0.007462950593389419, 0.007257959220364529, 0.0070618882689721775, 0.006874780471390905, 0.006696561899369178, 0.006527276500151317, 0.006366868064832855, 0.006215293829103107, 0.006072576632510309, 0.005938622157982737, 0.005813487323541425, 0.005697118409901361, 0.005589575001768929, 0.0054909102529480894, 0.00540127205833807, 0.005320851493937311, 0.0052499203318698475, 0.005189009450966953, 0.005138672544515977, 0.005099591354925812, 0.0050723044580304735, 0.00505681057875762, 0.005052290885175969, 0.005053809407017049, 0.0050569408868839745, 0.0050665495436938, 0.005085625819432926, 0.0051144804828831365, 0.005153382431337622, 0.005202477745571919, 0.005261689374587055, 0.005330839783430223, 0.005409724389234329, 0.005498092192342058, 0.005595787328109732, 0.005702646829358168, 0.005818586228171022, 0.005943517308513338, 0.006077408856855903, 0.006220253284736219, 0.006372033168476212, 0.006532766824887332, 0.006702449288993251, 0.006881074590873483, 0.007068660131212024, 0.0072651838139968245, 0.007470560581913012, 0.007684830376613649, 0.007907840775097614, 0.008139524037528647, 0.008379750366153233, 0.008628316955753884, 0.008885008603170312, 0.009149564566199522, 0.00942160943963438, 0.009700663547100431, 0.009986224443770442, 0.010277676696561907, 0.010574265089983211, 0.010875117709868959, 0.011179315730836952, 0.011485837454609257, 0.01179353701298513, 0.012101349512250989, 0.012407989950805587, 0.012712158146122565, 0.01301260652482966, 0.013307906405294593, 0.013596768966294179, 0.013877874502440091, 0.014149764450138023, 0.014411231907797167, 0.01466083454455106, 0.014897422332748841, 0.015119798753623596, 0.015326691191644287, 0.015517238211143241, 0.01569040134225259, 0.015845595458337955, 0.0159825190500987, 0.016101062289322926, 0.01620076303713623, 0.016280927854520465, 0.016340957397590793, 0.01638037922835832, 0.01639891762785503, 0.016396477797655108, 0.01637291530027604, 0.016328507252845518, 0.016263545502594776, 0.016178700565901864, 0.01607509895652945, 0.015954445879716905, 0.01581785578027046, 0.015665275668521824, 0.015495843162687543, 0.015309215759936115, 0.01510586399813733, 0.014886735181044483, 0.014652924985683945, 0.014405608647191443, 0.014146190079109323, 0.013875886465384908, 0.013596245593862468, 0.01330854255009812, 0.01301424765630969, 0.012714630437071705, 0.01241116643860092, 0.012105102556838849, 0.011797795196158851, 0.01149039151415354, 0.011184139288402653, 0.010880071408893875, 0.010579355060794444, 0.010282751591781741, 0.009991215940106215, 0.009705533028776147, 0.00942627329019177, 0.009154023009229831, 0.00888925739033746, 0.008632323456338756, 0.008383537690846531, 0.00814310875880626, 0.007911246959183582, 0.0076880199798806375, 0.007473625872894443, 0.0072680489729308306, 0.007071403617193621, 0.006883675584782726, 0.006704918086182546, 0.006535100034954809, 0.006374228708559128, 0.006222330718298537, 0.006079373718697005, 0.005945364103559186, 0.005820299204375259, 0.005704277312519102, 0.005597297382067963, 0.005499503103443545, 0.005411047565950603, 0.005332126720588344, 0.005262947895017611, 0.005203749222430543, 0.005154819545248696, 0.0051162706739523904, 0.005088132173995409, 0.0050703146662380945, 0.005062412993939023, 0.005060320259996521, 0.005059328517360208, 0.005064859313950815, 0.0050811159209473355, 0.005108269870621212, 0.005146333401320177, 0.005195487053204307, 0.005255356295732448, 0.005325394971330332, 0.005405112096796413, 0.0054941160835829655, 0.005592219058952204, 0.005699226961695272, 0.00581508504360331, 0.005939712212437438, 0.006073152895813198, 0.006215363902757211, 0.006366402878623566, 0.006526271470880554, 0.0066949978891432905, 0.0068726034469758866, 0.007059110967470953, 0.0072545125033597205, 0.007458751251048994, 0.0076718395289252835, 0.00789371197783321, 0.008124228972967596, 0.008363320910528948, 0.008610800934768152, 0.008866489822302528, 0.009130069978056909, 0.009401202252314741, 0.009679451588590838, 0.009964267037592634, 0.010254990365184525, 0.010550950920896942, 0.010851163067991611, 0.01115482734730712, 0.01146088508273135, 0.011768179580464456, 0.01207566406409562, 0.012382016235490076, 0.012686052766524021, 0.01298647823707666, 0.013281971482933884, 0.013571260965744824, 0.013852995638241846, 0.014125945405273047, 0.014388670548554602, 0.01464004157590459, 0.014878791764711281, 0.015103871693887988, 0.01531403294302012, 0.015508363683891326, 0.01568577943481768, 0.01584556835363142, 0.015986886020744658, 0.016109028182544092, 0.016211412878369323, 0.01629361185744464, 0.016355357431681043, 0.01639669630800457, 0.016417996183936082, 0.016419795261147625, 0.01640212101811448, 0.01636435547010682, 0.016306217187982783, 0.016227476067259924, 0.016128314032104716, 0.016009192794373052, 0.015870641605097602, 0.015713354380522702, 0.015538066296964952, 0.015345720126417453, 0.015137280744608196, 0.0149137419852097, 0.014676286023192478, 0.01442606617856165, 0.014164289605488356, 0.013892245797080557, 0.013611213072077903, 0.01332252872207966, 0.01302752334825862, 0.012727392601064825, 0.012423550382755326, 0.012117319339332766, 0.01180985366720049, 0.01150231846208321, 0.01119599316815133, 0.010891946991481721, 0.010591100851875743, 0.01029457042341028, 0.010003031974884984, 0.009717397641350111, 0.00943825524461063, 0.009166187078750339, 0.00890162285559875, 0.008644970191682037, 0.008396469680869306, 0.008156378758341506, 0.007924839837342854, 0.0077019710140805555, 0.007487858066715471, 0.007282584237883796, 0.007086141666111288, 0.00689857405201434, 0.006719875465512282, 0.006550030207976932, 0.006389027755733961, 0.0062368172117098, 0.006093416762460888, 0.005958721699391116, 0.00583282270240307, 0.005715677103764773, 0.005607275911879866, 0.0055077233767928495, 0.005417163946637944, 0.005335765362268568, 0.005263853014732384, 0.00520181452470314, 0.005150301078999049, 0.005109993992862554, 0.00508151880074269, 0.0050650371846387605, 0.005059716611060751, 0.0050607067820451655, 0.005062352076540845, 0.005068638777833771, 0.005084151892063387, 0.005109668018440007, 0.005145392174965636, 0.0051914470416913475, 0.005247698440871028, 0.00531398420517864, 0.00539005462110696, 0.005475651790192171, 0.0055706334852903, 0.005674784966025856, 0.005787998670785348, 0.005910202587054628, 0.006041345633190288, 0.006181430436225801, 0.0063303883191651806, 0.006488286822567935, 0.006655067705095899, 0.006830769540204174, 0.007015419894026473, 0.007208921975297437, 0.007411282159670231, 0.007622512057445863, 0.007842457236131573, 0.008071089882302974, 0.008308269920191807, 0.008553812590112042, 0.008807540643967406, 0.009069176457014397, 0.009338323702465392, 0.009614718977860455, 0.00989774549994567, 0.010186841812784836, 0.010481266414398421, 0.010780265952039769, 0.011082899680741871, 0.011388197664872396, 0.011695099943966093, 0.012002459320547922, 0.012309059960024201, 0.012613670582414607, 0.012915000883491793, 0.013211665542027946, 0.013502391653227235, 0.013785825888011917, 0.014060668672551081, 0.014325474461420589, 0.014578938461788303, 0.014819919778904353, 0.015047051525004884, 0.015259263310479955, 0.015455502697269224, 0.01563467512532948, 0.015796120295237102, 0.015939386163774424, 0.016064445302373897, 0.01617099706903335, 0.016258373390375967, 0.016325846361534963, 0.016372971056395548, 0.016399328210309268, 0.016404817600406834, 0.016389329436408015, 0.016352944055337746, 0.016295917082285845, 0.016218886768318726, 0.01612270276267047, 0.01600893152094174, 0.015879098188174165, 0.015733569133595606, 0.01557138969018635, 0.015392202670756281, 0.015196043746790443, 0.01498369612512446, 0.014756295190165582, 0.014514911914117511, 0.014260823021596307, 0.013995387952446902, 0.01372008119099175, 0.013436113605091032, 0.013144930223095841, 0.01284795671020139, 0.012546506855993095, 0.01224196304986514, 0.011935602221650925, 0.011628639149224393, 0.01132235319051743, 0.011017790525834435, 0.010716030994002758, 0.010418090405847643, 0.010124806668113074, 0.009836978800515919, 0.009555345542077594, 0.009280416262542992, 0.009012784955312826, 0.008752779189956922, 0.00850074741629205, 0.008256932862048141, 0.008021577905686071, 0.007794798091823759, 0.007576702038724013, 0.007367380240188277, 0.007166945112545169, 0.006975360134491414, 0.006792702113386096, 0.0066189655268871226, 0.00645413288720588, 0.006298222749891838, 0.0061512462188711425, 0.00601316624701426, 0.005884036152865349, 0.0057638144132080744, 0.00565263995211835, 0.005550551056887797, 0.005457702364672897, 0.005374199927205953, 0.005300360308733991, 0.0052363541369721284, 0.005182431310405214, 0.005138833004715286, 0.005105599964117489, 0.005082718114193935, 0.005070037233207261, 0.0050659444302556065};
    return 0.010131038211114112+(vc[k]-0.010131038211114112)/2.;
}

int main(int argc, char **argv) {
    mpi.init();

    // Set up the lattice, including the resolution and data/parallelisation method
    using Lattice = LatticeProperties<ParallelX<1>, lx, ly>;

    // We use the 'FlowField' LBM model, which is the standard Navier-Stokes solver
    // We need to modify the traits of the model to include a body force.
    using PoiseuilleTrait = DefaultTraitFlowField<Lattice>::AddForce<CDFTForce<>>::SetCollisionOperator<MRT>::SetProcessor<std::tuple<C1FromTable>,std::tuple<Gradients<C1<>,CentralXYZ>,Gradients<Density<>,CentralXYZ>>>;
    FlowField<Lattice, PoiseuilleTrait> model;

    // Define the magnitude of the body force
    //model.getProcessor<C1FromTable>().setElectricField(calcElectricField);
    model.getProcessor<C1FromTable>().setRhoMinMax(0.005052290885175969,0.016466639471248587);//0.003789218163881977,0.019759967365498305);
    //model.getProcessor<C1FromTable>().setElecMinMax(-9.2346,9.2346);//-11.08152,11.08152);0.005052290885175969 0.016466639471248587
    model.getProcessor<C1FromTable>().setRhoConversion(1);//0.010131038211114112);
    std::vector<double> tab;
    std::ifstream file("/home/mrennick99/cdft/cdft-pressure/output/c1.txt");
    tab.resize(lx);
    for (int i=0;i<lx;i++){
        file>>tab[i];
    }/*
        tab[i].resize(2000);
        for (int j=0;j<2000;j++){
            file>>tab[i][j];
            //std::cout<<tab[i][j]<<std::endl;
        }
    }*/
    model.getProcessor<C1FromTable>().setTable(tab);
    file.close();

    // Define the solid boundaries
    Geometry<Lattice>::initialiseBoundaries(initSolid);
    model.getBoundary<BounceBack>().setNodeID(1);

    Density<>::set<Lattice>(initDensity);//0.010131038211114112);
    //ElectricField<>::set<Lattice>(calcElectricField);
    model.setTau(1.0);

    // Set up the handler object for saving data
    SaveHandler<Lattice> saver("data/");
    saver.saveHeader(timesteps, saveInterval);  // Create a header with lattice information (lx, ly, lz, NDIM (2D or
                                                // 3D), timesteps, saveInterval)

    // Algorithm creates an object that can run our chosen LBM model
    Algorithm lbm(model);

    // Perform the main LBM loop
    for (int timestep = 0; timestep <= timesteps; timestep++) {
        TIME=timestep;
        if (timestep % saveInterval == 0) {
            // Use the save handler to save the solid and the velocity
            saver.saveParameter<Density<>>(timestep);
            saver.saveParameter<Velocity<>, Lattice::NDIM>(timestep);
            std::cout << "Saving at timestep " << timestep << "." << std::endl;
        }
        std::string python = "python /home/mrennick99/cdft/cdft-pressure/cdft/UpdateC1.py ";
        std::string time = std::to_string(timestep);
        std::string execute = python+time;
        if(timestep%10==0) system(execute.c_str());
        lbm.evolve();
        
    }

    return 0;
}
